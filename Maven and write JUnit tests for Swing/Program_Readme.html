<!DOCTYPE html>
<html lang="ru">
<head><title>Описание программы</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<article>
	
	<p>Данный пример поясняет, как можно рисовать в Swing-окне. Кроме того, что более интересно, в примере демонстрируется, как можно использовть JUnit, для тестирования отрисовки (примеры в исходниках), свойств фрейма (размеров и позиции на экране) и т.д.</p>

	<p>Особенностью в этом примере является использование класса <span class="code">Executors</span>, в классе <span class="code">Main</span>, а так же класса <span class="code">EventListenerList</span> в классе <span class="code">AbstractLayer</span>.</p>

<hr>
<br>

<p>Поскольку, я потратил некоторое время, разбираясь, как организована программа, - напишу здесь, на случай, если со временем забуду.</p>

Программа запускается из класса <span class="code">Main</span>. В статическом методе класса <span class="code">Main</span> - т.е. в методе <span class="code">public static void main(String[] args)</span> вызывается конструктор класса (<span class="code">new Main()</span>), после чего, когда конструктор вернет ссылку на созданный объект, у него вызывается метод <span class="code">start()</span>, определенный в этом классе.

<p>В конструкторе класса <span class="code">Main</span> проиходит подготовка. Создается фрейм (<span class="code">PainFrame</span>), в котором происходит рисование. А так же создается объект класса <span class="code">RectangleLayer</span> с именем <span class="code">layer</span>. Класс <span class="code">RectangleLayer</span> представляет собой объект, который будет отрисовываться и является потомком абстрактного класса <span class="code">AbstractLayer</span>. У класса <span class="code">RectangleLayer</span> нет своего конструктора (есть конструктор по умолчанию, который заботливо предоставлен JRE, но он нас не интересует), и при создании объекта <span class="code">RectangleLayer</span> вызывается конструктор абстрактного класса-родителя. Этот конструктор, нас, в принципе, так же не интересует, так как он особенно ничего не делает, он присваивает внутренней переменной <span class="code">weight</span> (вес) значение <span class="code">0</span>. По видимости эта пременная - <span class="code">weight</span> - никакой роли, в этой демонстрационной программе, не играет, и возможно нужна для создания функционала, где прорисовка слоев может зависить от "веса" слоя.</p>

<p>В классе <span class="code">RectangleLayer</span> есть приватные поля для хранения координат (<span class="code">x</span>, <span class="code">y</span>), а также поля для хранения заданных ширины и высоты (<span class="code">width</span> и <span class="code">heigh</span>). Кроме этого, в классе переопределен метод <span class="code">public void draw(Graphics2D gr)</span> абстрактного класса-родителя, в котором производится рисование квадрата с координатам и размерами, которые хранятся в приватных переменных класса (т.е. в переменных <span class="code">x</span>, <span class="code">y</span>, <span class="code">width</span> и <span class="code">heigh</span>). Кроме того, в классе <span class="code">RectangleLayer</span> сущестует метод <span class="code">setCoordinates(int x1, int y1, int width, int height)</span>, для указания координат и размеров квадрата, который будет отрисован.</p>

<p>В классе фрейма (<span class="code">PainFrame</span>), нет ничего примечательного. При создании фрейма задается положение фрейма на дисплее, его размеры. Задается поведение при закрытии фрейма, - чтобы программа завершила свою работу. Также устанавливается поведение фрейма, чтобы было невозможно изменить его размеры.</p> 

<p>Во фрейме создается панель для рисования (<span class="code">DrawPanel</span>) и размещается во фрейме. Так же во фрейме есть метод, для получения внешним объектом панели для рисования <span class="code">DrawPanel</span>. Этот метод используется в методе <span class="code">start()</span> в классе <span class="code">Main()</span>.</p>

<p>Класс панели для рисования <span class="code">DrawPanel</span>, когда создается в фрейме <span class="code">PainFrame</span> ничего не делает. В его методе для рисования <span class="code">paintComponent(Graphics g)</span> вызывается метод <span class="code">drawObjects(Graphics2D gr)</span>, в котором, в свою очередь, просматривается сортированный список (<span class="code">SortedSet&lt;AbstractLayer&gt; layers</span>) и для каждого объекта в этом списке вызывает метод <span class="code">draw(Graphics2D gr)</span>. На момент, когда создается панель, этот список (<span class="code">layers</span>) будет пустым.</p>

<p>Итак, в конструкторе класса <span class="code">Main</span> создается объект фрейма - экземпляр класса <span class="code">PaintFrame</span>. После чего, у объекта <span class="code">RectangleLayer</span> задаются координаты и размеры слоя, путем вызова метода <span class="code">layer.setCoordinates(10, 10, 20, 20)</span>. - т.е. задаются координаты <span class="code">x, y = 10, 10</span> и размеры сторон квадрата равными <span class="code">20</span>. В данном методе, как я уже писал выше, задаются координаты и размеры квадрата для отрисовки. Кроме того, после установки координат и размеров квадрата, - в этом методе вызывается метод <span class="code">fireLayerStateUpdatedEvent(new LayerStateUpdatedEvent(this))</span> класса-родителя, который сообщает о изменении состояния объекта. В метод <span class="code">fireLayerStateUpdatedEvent()</span> передается создаваемый на месте объект события <span class="code">LayerStateUpdatedEvent</span>, который принимает в качестве аргумента в конструктор объект источник события (<span class="code">this</span>) в данном случае - объект источник события будет объект-экземпляр класса <span class="code">RectangleLayer</span>.</p> 

<p>В событии <span class="code">LayerStateUpdatedEvent</span> сохраняется объект <span class="code">RectangleLayer</span> (источник события), который используется для получения координат для прорисовки. Кроме того, в событии сохраняется штамп времени (не используется в программе).</p>

<p>Метод <span class="code">fireLayerStateUpdatedEvent</span>, определенный  в абстрактном классе <span class="code">AbstractLayer</span> производит запуск события, - т.е у каждого слушателя, из списка слушателей событий, так же определенном в  абстрактном классе <span class="code">AbstractLayer</span>, - объекта класса <span class="code">EventListenerList</span> с именем <span class="code">listenerList</span> вызывается метод <span class="code">stateUpdated()</span>.</p>

<p>Этот список слушателей событий (т.е. список экземпляр класса <span class="code">EventListenerList</span> ) просматривается и определяется, - если слушатель соответсвует интерфейсу <span class="code">ILayerStateUpdatedListener</span>, - тогда у слушателя вызывается соответствующий метод обработки события - т.е. <span class="code">stateUpdated()</span>.</p> 

<p>Итак, в классе <span class="code">Main</span>, в самом начале работы программы, после задания координат и размеров объекта <span class="code">RectangleLayer</span>, вызванный метод <span class="code">fireLayerStateUpdatedEvent</span> ничего не делает, поскольку в списке слушателей событий (<span class="code">EventListenerList</span>) нет зарегистрованных слушателей. Они добавляеют в список слушателей событий (<span class="code">EventListenerList listenerList</span>) позднее.</p>

<p>После того, как объект класса <span class="code">Main</span> был создан, - вызывается метод <span class="code">start()</span>, определенный в этом классе. В этом методе сначала вызывается метод <span class="code">getDrawPanel()</span> объекта <span class="code">PaintFrame</span>. Указанный метод возвращает панель для рисования - объект класса <span class="code">DrawPanel</span>. И затем, в панель для рисования добавляется слой - объект класса <span class="code">RectangleLayer</span>, путем вызова методе <span class="code">addLayer()</span>, определенный в классе <span class="code">DrawPanel</span>.</p>

<p>В методе <span class="code">addLayer()</span> класса <span class="code">DrawPanel</span> в сортированный список <span class="code">SortedSet&lt;AbstractLayer&gt; layers</span> добавляется слой - объект класса <span class="code">RectangleLayer</span>, а также регистрируется новый слушатель события, путем вызова метода <span class="code">addLayerStateUpdatedListener(new DefaultLayerStateUpdatedListener(this))</span>. Этот метод определен в абстрактном классе-родителе <span class="code">AbstractLayer</span>, и он  добавляет в список слушателей события <span class="code">EventListenerList listenerList</span> новый обработчик (слушатель) события - в данном случае это экземпляр класса <span class="code">DefaultLayerStateUpdatedListener</span>.</p> 

<p>Слушатель события <span class="code">DefaultLayerStateUpdatedListener</span> создается на месте, как анонимный объект, и принимает в качестве аргумета в конструктор объект - родительский компонент (<span class="code">this</span>) - что, в нашем случае, соответвует панели для рисования <span class="code">DrawPanel</span>. Когда произойдет событие - т.е. когда у слушателя события будет вызван метод <span class="code">stateUpdated()</span>, будет произведена отрисовка панели (вызвает метод <span class="code">repaint()</span> у панели для рисования <span class="code">DrawPanel</span>). Так же стоит отметить, что метод <span class="code">repaint()</span> вызывается с аргументами, для оптимальной работы программы, а параметры соответсвуют координатам и размерам квадрата для отрисовки. Эти размеры и координаты квадрата берутся из объекта события <span class="code">LayerStateUpdatedEvent</span>, переданного в метод <span class="code">stateUpdated()</span> в качестве аргумента.</p>

<p>Затем, в методе <span class="code">start()</span> класса <span class="code">Main</span>, после того, как на панель для рисования был добавлен слой (<span class="code">RectangleLayer</span>)  вызывается статический метод <span class="code">Executors.newSingleThreadExecutor()</span> класса <span class="code">Executors</span> который возвращает объект <span class="code">Executor</span> и вызывается метод <span class="code">execute()</span> этого объекта. В качестве аргумента в метод <span class="code">execute()</span> передается объект реализующий интерфейс <span class="code">Runnable</span>. В нашем случае мы передаем в метод <span class="code">execute()</span> экземпляр класса <span class="code">MoveRectangleBehavior</span>, который сразу же и создается, как анонимный объект.</p>

<p>Конструктор класса <span class="code">MoveRectangleBehavior</span> принимает ссылку на объект-слой (<span class="code">RectangleLayer</span>), которым будет управлять данный класс. В этом классе, как в любом классе, реализующем интерфейс <span class="code">Runnable</span>, имеется метод <span class="code">run()</span> который запускается в отдельном потоке, и производит в бесконечном цикле с ожиданием 5 млсек, изменение координат слоя (объект класса <span class="code">RectangleLayer</span>), ссылку на которую он содержит.</p>

<p>Итак, вернемся вновь к классу <span class="code">Main</span>. После описанного выше, класс <span class="code">Main</span> в методе <span class="code">start()</span>, устанавливается окно фрейма видимым. Вот и все</p>

<h3>Подведем итоги:</h3>

	<ul>
		<li>Создается слой <span class="code">RectangleLayer</span> - объект, который должен отрисовываться.</li>
		<li>Создается окно с фреймом (<span class="code">PaintFrame</span>).</li>
		<li>Во фрейме (<span class="code">PaintFrame</span>) размещается панель для отрисовки <span class="code">DrawPanel</span>.</li>
		<li>Добавляем созданный слой (объект класса <span class="code">RectangleLayer</span>) на панель для отрисовки, тем самым в методе <span class="code">addLayer()</span> в классе панели для отрисовки <span class="code">DrawPanel</span>,  в список слушателей событий <span class="code">EventListenerList listenerList</span>, определенный в абстрактном классе <span class="code">AbstractLayer</span>, добавляется слушатель.</li>
		<li>Запускаем метод <span class="code">Executors.newSingleThreadExecutor().execute()</span> передав в качестве аргумента объект, реализующий интерфейс <span class="code">Runnable</span> - <span class="code">MoveRectangleBehavior</span></li>
		<li><span class="code">MoveRectangleBehavior</span>, выполнятся как отдельный поток. Здесь меняются координаты слоя - объекта класса <span class="code">RectangleLayer</span>. При измении координат (или размеров) вызывается метод <span class="code">fireLayerStateUpdatedEvent</span>, определенный в абстрактном классе <span class="code">AbstractLayer</span>. В этом методе просматривается список всех слушателей событий, и для тех, которые соотвествуют критерию (объект реализующий интерфейс <span class="code">ILayerStateUpdatedListener</span>) вызывается метод <span class="code">stateUpdated()</span> у соответсвующего слушателя</li>
		<li>В методе <span class="code">stateUpdated()</span> слушателя производится прорисовка панели (с координатами). Координаты слушатель получает из объекта события <span class="code">LayerStateUpdatedEvent</span>.</li>
	</ul>
  </article>
</body></html>
